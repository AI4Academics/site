<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AI4SAT Tutor API Test</title>
  <style>
    body { font-family: system-ui, sans-serif; padding: 2rem; max-width: 820px; margin: auto; }
    input, button { padding: .5rem; font-size: 1rem; margin: .25rem 0; }
    #output { white-space: pre-wrap; background: #f8f8f8; padding: 1rem; border-radius: 8px; margin-top: 1rem; }
    .row{margin-bottom:1rem}
    label{font-weight:600}
    .success { background: #d4edda; color: #155724; padding: 1rem; border-radius: 8px; margin-top: 1rem; }
    .error { background: #f8d7da; color: #721c24; padding: 1rem; border-radius: 8px; margin-top: 1rem; }
  </style>
</head>
<body>
  <h1>AI4SAT Tutor: Practice </h1>
  <!--
  <div class="row">
    <label>API Base URL:</label><br>
    <input id="api" size="60" value="https://ai4sat-tutor-api-jkle.vercel.app">
    <div style="font-size:.9rem;color:#555">Replace with your actual Vercel URL or custom domain (e.g., https://api.ai4academics.org)</div>
  </div> 
  -->

  <div class="row">
    <label>Question:</label><br>
    <input id="question" value="6523 × 5 = ?" size="40">
  </div>

  <div class="row">
    <label>Answer:</label><br>
    <input id="answer" value="32615" size="20">
  </div>

  <button onclick="send()">Check Answer</button>

  <h3>Response:</h3>
  <div id="output">(results will appear here)</div>
  <div id="feedback"></div>

  <script>
    async function send() {
      const api = "https://ai4sat-tutor-api-jkle.vercel.app"; // Hardcode the API URL
      const question = document.getElementById('question').value;
      const answer = document.getElementById('answer').value;
      //const output = document.getElementById('output');
      const feedback = document.getElementById('feedback');

      //console.log('[v0] Starting API call...');
      //console.log('[v0] API URL:', api + "/api/check-answer");
      //console.log('[v0] Request data:', { question, answer });
      
      // Clear previous results
      feedback.innerHTML = '';
      //output.textContent = 'Making request...';

      try {
        const resp = await fetch(api + "/api/check-answer", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ question, answer })
        });

        //console.log('[v0] Response received:', resp.status, resp.statusText);
        //console.log('[v0] Response headers:', Object.fromEntries(resp.headers.entries()));

        const text = await resp.text();
        //console.log('[v0] Response text:', text);
        
        let body;
        try { body = JSON.parse(text); } catch { body = text; }

        if (resp.ok && typeof body === 'object' && body.correct !== undefined) {
          feedback.className = body.correct ? 'success' : 'error';
          feedback.innerHTML = `
            <strong>${body.correct ? '✅ Correct!' : '❌ Incorrect'}</strong><br>
            ${body.feedback}<br>
            ${body.nextQuestion ? `<strong>Next Question:</strong> ${body.nextQuestion.question}` : ''}
          `;
          
          // Auto-populate next question if available
          if (body.nextQuestion) {
            document.getElementById('question').value = body.nextQuestion.question;
            document.getElementById('answer').value = '';
            document.getElementById('answer').focus();
          }
        } else {
          feedback.className = 'error';
          feedback.textContent = 'API Error: ' + (body.error || 'Unknown error');
        }
        /*
        output.textContent =
          "Status: " + resp.status + " " + resp.statusText + "\n" +
          "URL: " + resp.url + "\n" +
          "Headers: " + JSON.stringify(Object.fromEntries(resp.headers.entries()), null, 2) + "\n\n" +
          "Body:\n" + (typeof body === "string" ? body : JSON.stringify(body, null, 2));
        */
      } catch (err) {
        //console.log('[v0] Fetch error:', err);
        feedback.className = 'error';
        feedback.textContent = "Connection Error: " + err.message;
        //output.textContent = "Fetch error: " + err.message +
        //  "\n(Hint: If this is a CORS preflight issue, ensure the API sends Access-Control-Allow-* headers and that ALLOWED_ORIGIN matches this page's origin.)";
      }
    }

    document.getElementById('answer').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        send();
      }
    });
  </script>
</body>
</html>
